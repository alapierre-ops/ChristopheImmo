---
import Layout from '../layouts/Layout.astro';
import propertiesData from '../data/properties.json';
import '../styles/index.css';

interface Property {
	id: string;
	title: string;
	address: string;
	price: number;
	surface: number;
	rooms: number;
	description: string;
	images: string[];
	features: string[];
}

const properties: Property[] = propertiesData;
const totalProperties = properties.length;
const averagePrice = Math.round(properties.reduce((sum, p) => sum + p.price, 0) / properties.length);
---

<Layout title="Propriétés à louer">
	<main>
		<header class="header">
			<div class="container">
				<h1>Propriétés disponibles</h1>
				<p class="subtitle">Découvrez notre sélection de biens immobiliers à la location</p>
			</div>
		</header>

		<div class="container">
			<section class="intro-section">
				<div class="intro-content">
					<h2>Bienvenue</h2>
					<p>
						Nous proposons une sélection de biens immobiliers de qualité, soigneusement choisis pour répondre à vos besoins. 
						Que vous recherchiez un studio pour étudiant, un appartement familial ou un logement en centre-ville, 
						nous avons ce qu'il vous faut. Tous nos biens sont disponibles immédiatement et prêts à vous accueillir.
					</p>
					<div class="stats">
						<div class="stat-item">
							<div class="stat-number">{totalProperties}</div>
							<div class="stat-label">Propriétés</div>
						</div>
						<div class="stat-item">
							<div class="stat-number">{averagePrice}€</div>
							<div class="stat-label">Prix moyen</div>
						</div>
						<div class="stat-item">
							<div class="stat-number">100%</div>
							<div class="stat-label">Disponibles</div>
						</div>
					</div>
				</div>
			</section>

			<section class="properties-section">
				<div class="section-header">
					<h2>Nos biens disponibles</h2>
					<p>Parcourez notre catalogue de propriétés à louer</p>
				</div>

				<div class="properties-grid">
					{properties.map((property) => (
						<a 
							href={`/bien/${property.id}`} 
							class="property-card"
							data-property-id={property.id}
							data-property-title={property.title}
						>
							<div class="property-badge">Disponible</div>
							<div class="property-image">
								{property.images && property.images.length > 0 ? (
									<>
										<img src={property.images[0]} alt={property.title} />
										{property.images.length > 1 && (
											<div class="image-count">
												<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
													<rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
													<circle cx="8.5" cy="8.5" r="1.5"/>
													<polyline points="21 15 16 10 5 21"/>
												</svg>
												{property.images.length} photos
											</div>
										)}
									</>
								) : (
									<div class="placeholder-image">Pas d'image</div>
								)}
							</div>
							<div class="property-content">
								<h2 class="property-title">{property.title}</h2>
								<p class="property-address">
									<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
										<path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
										<circle cx="12" cy="10" r="3"/>
									</svg>
									{property.address}
								</p>
								<p class="property-description">{property.description}</p>
								<div class="property-details">
									<span class="detail-item">
										<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
											<rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
											<line x1="9" y1="3" x2="9" y2="21"/>
											<line x1="3" y1="9" x2="21" y2="9"/>
										</svg>
										{property.surface} m²
									</span>
									<span class="detail-item">
										<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
											<path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
											<polyline points="9 22 9 12 15 12 15 22"/>
										</svg>
										{property.rooms} pièce{property.rooms > 1 ? 's' : ''}
									</span>
								</div>
								{property.features && property.features.length > 0 && (
									<div class="property-features">
										{property.features.slice(0, 3).map((feature) => (
											<span class="feature-tag">{feature}</span>
										))}
									</div>
								)}
								<div class="property-price">
									{property.price} €/mois
								</div>
							</div>
						</a>
					))}
				</div>
			</section>
		</div>

		<footer class="footer">
			<div class="container">
				<div class="footer-content">
					<div class="footer-section">
						<h3>À propos</h3>
						<p>
							Nous proposons des biens immobiliers de qualité pour la location. 
							Tous nos logements sont soigneusement sélectionnés et entretenus.
						</p>
					</div>
					<div class="footer-section">
						<h3>Contact</h3>
						<p>
							Pour toute question ou visite, n'hésitez pas à nous contacter.
						</p>
						<p>
							<a href="mailto:christophe-lapierre@orange.fr">christophe-lapierre@orange.fr</a>
						</p>
						<p>
							<a href="tel:+33601767543">+33 6 01 76 75 43</a>
						</p>
					</div>
					<div class="footer-section">
						<h3>Informations</h3>
						<p>
							Tous nos biens sont disponibles immédiatement. 
							Les visites peuvent être organisées sur rendez-vous.
						</p>
					</div>
				</div>
				<div class="footer-bottom">
					<p>&copy; {new Date().getFullYear()} Propriétés à louer. Tous droits réservés.</p>
				</div>
			</div>
		</footer>
	</main>
</Layout>

<script>
	import { events } from '../utils/posthog';
	
	events.pageView('home');
	
	document.addEventListener('DOMContentLoaded', () => {
		const propertyCards = document.querySelectorAll('.property-card');
		propertyCards.forEach((card) => {
			card.addEventListener('click', () => {
				const propertyId = card.getAttribute('data-property-id');
				const propertyTitle = card.getAttribute('data-property-title');
				if (propertyId && propertyTitle) {
					events.propertyCardClicked(propertyId, propertyTitle);
				}
			});
		});
	});
</script>